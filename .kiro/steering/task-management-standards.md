---
inclusion: always
---

# タスク管理・品質管理ルール

## 🎯 基本原則

**技術的負債の雪だるま式蓄積を防ぐため、客観的で検証可能な完了基準を必須とする**

### アジャイル開発の 4 原則（2025 年 8 月 11 日更新）

1. **垂直スライス優先**: 水平レイヤーではなく、完全な価値提供フローを実装する
2. **動作確認必須**: 各タスクで実際のユーザー体験を確認する
3. **フィードバック収集**: 実際のユーザーからの意見・要望を収集する
4. **品質とスピード両立**: 品質を妥協せず、短いフィードバックサイクルを実現する

### 承認ベース進行の原則

- **サブタスク単位承認**: 各サブタスク完了時にユーザー承認必須
- **技術調査義務**: 実装前の公式ドキュメント確認必須（MCP サーバ活用推奨）
- **根拠ある修正**: タスクリスト修正時の調査結果提示必須
- **勝手な進行禁止**: ユーザー承認なしに次のサブタスクに進まない

## 📝 タスク作成時の必須原則

### 設計からタスクへの落とし込み基準

**要件追加・設計変更時に、客観的で検証可能なタスクを必ず作成する**

#### 1. 完了基準の事前定義

- **コマンド実行による検証**: 具体的なコマンド + 期待結果を必須記載
- **テスト通過基準**: `uv run pytest <specific_test> -v` で全テスト PASSED
- **品質メトリクス**: ruff, mypy チェックを全タスクに必須追加
- **ファイル存在確認**: 具体的なファイルパス + 内容確認方法を明記

#### 2. 曖昧表現の禁止

**禁止表現**:

- ❌ 「〜の実装」「〜の作成」「〜の設定」
- ❌ 「動作確認」「成功」「完了」
- ❌ 「手動テスト」「目視確認」

**必須表現**:

- ✅ 「`command` で exit code 0 + 期待ログ出力」
- ✅ 「`uv run pytest tests/path/ -v` で全テスト PASSED」
- ✅ 「`file_path` ファイル存在 + 内容に `expected_content` 含有」

#### 3. 依存関係の明確化

- **前提条件**: 前タスクの具体的な成果物を明記
- **成果物**: 後続タスクが依存する具体的なファイル・機能を明記
- **検証方法**: 依存関係が満たされていることの確認方法を明記

#### 4. 垂直スライス開発の基準（2025 年 8 月 11 日追加）

- **完全フロー実装**: 入力から出力まで完全に動作する機能を実装
- **ユーザー価値優先**: 実際に使われる機能を最優先で実装
- **フィードバック駆動**: 各イテレーションでユーザーフィードバックを収集
- **1-2 週間サイクル**: 短期間で価値提供とフィードバック収集を実現

## 📋 タスク完了の必須条件

### 1. 受け入れテスト駆動開発（ATDD）

- **既存テスト活用**: TDD で作成する単体・統合・E2E テストを受け入れ基準に活用
- **コマンド確認**: インフラ・環境系は実際のコマンド実行で確認
- **完了基準**: 各タスクの性質に応じた適切な検証方法の 100%通過
- **進行禁止**: 受け入れ基準未達での次タスク進行は禁止
- **保守性重視**: 専用受け入れテストは最小限に、既存テスト資産を最大活用

### 2. 客観的検証可能性

- **主観的判断禁止**: 「できた」「動いた」等の主観的判断は無効
- **コマンド実行による検証**: 自動化されたテスト・コマンドによる客観的確認
- **再現可能性**: 他のメンバーが同じ手順で同じ結果を得られること

## 🔄 実装手順

### Phase 1: 完了基準の確認

1. タスクの完了基準を確認（既存テスト活用・コマンド確認）
2. 必要に応じてテスト実行環境の確認
3. 専用受け入れテストは最小限に抑制

### Phase 2: 実装・検証サイクル

1. サブタスク単位での実装
2. TDD による単体・統合テストの作成・実行
3. 問題発見時の即座修正

### Phase 3: 完了確認

1. 既存テスト（単体・統合・E2E）の実行
2. インフラ系は実際のコマンド実行で確認
3. 100%通過の確認
4. タスクステータスの更新（taskStatus tool 使用）

## 📊 品質メトリクス

### 必須メトリクス

- **受け入れテスト通過率**: 100%必須
- **コードカバレッジ**: 新規作成コードの 80%以上
- **リンター・フォーマッター**: `uv run ruff check app/ tests/` でエラー 0 件
- **型チェック**: `uv run mypy app/ tests/` でエラー 0 件（本番・テスト両方）
- **IDE 表示**: Kiro IDE 問題タブでエラー 0 件（精神衛生上必須）

## 🚫 禁止事項

### 絶対禁止

- **受け入れテスト未通過での次タスク進行**
- **「とりあえず動く」状態での完了宣言**
- **検証不可能な成果物の提出**
- **技術的負債の意図的先送り**
- **IDE 上でのエラー表示を残したままの完了宣言**
- **テストコードの型チェック緩和設定**

### 強く非推奨

- **手動テストのみによる検証**
- **環境依存の検証方法**
- **「テストだから品質を下げても良い」という考え方**
- **複雑すぎる受け入れテスト**

## 🔍 技術調査ガイドライン

### MCP サーバ活用による効率的調査

利用可能な MCP サーバを積極的に活用して技術調査を実施する：

#### AWS 関連調査

- **aws-docs**: AWS 公式ドキュメント検索・読み込み
- **aws-knowledge**: AWS 包括的知識ベース（ドキュメント・ブログ・What's New・Well-Architected 等）
- **aws-pricing**: AWS 料金情報・コスト分析
- **aws-diagram**: AWS アーキテクチャ図生成

#### ライブラリ・技術調査

- **context7**: 最新ライブラリ情報・ドキュメント取得
- **playwright**: E2E テスト・ブラウザ自動化情報

#### 開発支援

- **git**: リポジトリ状態確認・履歴調査

### 調査優先順位

1. **MCP サーバ活用**: 上記 MCP サーバでの公式情報取得
2. **公式ドキュメント**: 直接的な公式サイト確認
3. **GitHub 公式リポジトリ**: サンプルコード・Issue 確認

## 🔧 必須ツール

- **pytest**: 受け入れテスト実行
- **taskStatus**: タスク状態管理
- **uv**: 依存関係・環境管理
- **ruff**: コード品質チェック
- **mypy**: 型チェック

## ✅ タスク作成時チェックリスト

### 新規タスク作成時の必須確認項目

**要件追加・設計変更時に以下を必ず確認**:

#### 完了基準チェック

- [ ] 具体的なコマンド + 期待結果が明記されているか
- [ ] `uv run pytest <specific_test> -v` でのテスト通過基準があるか
- [ ] `uv run ruff check app/ tests/` でのリンターチェックが含まれているか
- [ ] `uv run mypy app/ tests/` での型チェックが含まれているか
- [ ] ファイル存在確認は具体的なパス + 内容確認方法があるか

#### 表現チェック

- [ ] 「実装」「作成」「設定」等の曖昧表現を使用していないか
- [ ] 「動作確認」「成功」「完了」等の主観的表現を使用していないか
- [ ] 「手動テスト」「目視確認」等の検証不可能な表現を使用していないか

#### 依存関係チェック

- [ ] 前提条件（前タスクの成果物）が具体的に明記されているか
- [ ] 成果物（後続タスクが依存するもの）が具体的に明記されているか
- [ ] 依存関係の検証方法が明記されているか

#### サブタスクチェック

- [ ] 各サブタスクが 2 時間以内で完了可能な粒度か
- [ ] 各サブタスクが独立して実行可能か
- [ ] 各サブタスクに具体的な検証方法があるか

## 🎯 成功基準

### プロジェクトレベル

- **技術的負債の最小化**: 各タスク完了時点での負債ゼロ
- **品質の一貫性**: 全タスクで同等の品質基準維持
- **開発効率の向上**: 後続タスクでの予期しない問題の排除
- **タスク品質の保証**: 新規作成タスクの客観性・検証可能性確保

### チームレベル

- **信頼性の向上**: 成果物の品質に対する信頼
- **属人化の排除**: 客観的基準による評価統一
- **学習効果の最大化**: 品質意識の向上
- **継続的改善**: タスク作成プロセスの品質向上

---

**適用開始**: 2025 年 8 月 4 日
**対象**: 全実装タスク
**例外**: ユーザー明示的承認時のみ
