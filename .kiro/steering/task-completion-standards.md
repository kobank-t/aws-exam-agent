---
inclusion: always
---

# タスク完了基準・品質管理ルール

## 🎯 基本原則

**技術的負債の雪だるま式蓄積を防ぐため、客観的で検証可能な完了基準を必須とする**

## 📋 タスク完了の必須条件

### 1. 受け入れテスト駆動開発（ATDD）

- **既存テスト活用**: TDD で作成する単体・統合・E2E テストを受け入れ基準に活用
- **コマンド確認**: インフラ・環境系は実際のコマンド実行で確認
- **完了基準**: 各タスクの性質に応じた適切な検証方法の 100%通過
- **進行禁止**: 受け入れ基準未達での次タスク進行は禁止
- **保守性重視**: 専用受け入れテストは最小限に、既存テスト資産を最大活用

### 2. 客観的検証可能性

- **主観的判断禁止**: 「できた」「動いた」等の主観的判断は無効
- **コマンド実行による検証**: 自動化されたテスト・コマンドによる客観的確認
- **再現可能性**: 他のメンバーが同じ手順で同じ結果を得られること

### 3. サブタスクの細分化

- **検証可能な単位**: 各サブタスクに具体的な検証方法を定義
- **段階的確認**: サブタスク完了時点での中間検証
- **依存関係の明確化**: 前タスクの成果物への依存を明記

## 🔄 実装手順

### Phase 1: 完了基準の確認

1. タスクの完了基準を確認（既存テスト活用・コマンド確認）
2. 必要に応じてテスト実行環境の確認
3. 専用受け入れテストは最小限に抑制

### Phase 2: 実装・検証サイクル

1. サブタスク単位での実装
2. TDD による単体・統合テストの作成・実行
3. 問題発見時の即座修正

### Phase 3: 完了確認

1. 既存テスト（単体・統合・E2E）の実行
2. インフラ系は実際のコマンド実行で確認
3. 100%通過の確認
4. タスクステータスの更新（taskStatus tool 使用）

## 📊 品質メトリクス

### 必須メトリクス

- **受け入れテスト通過率**: 100%必須
- **コードカバレッジ**: 新規作成コードの 80%以上
- **リンター・フォーマッター**: `uv run ruff check app/ tests/` でエラー 0 件
- **型チェック**: `uv run mypy app/ tests/` でエラー 0 件（本番・テスト両方）
- **IDE 表示**: Kiro IDE 問題タブでエラー 0 件（精神衛生上必須）

### 推奨メトリクス

- **セキュリティチェック**: 既知の脆弱性 0 件
- **パフォーマンス**: 基本的な性能要件満足
- **ドキュメント**: 型注釈による自己文書化

## 🚫 禁止事項

### 絶対禁止

- **受け入れテスト未通過での次タスク進行**
- **「とりあえず動く」状態での完了宣言**
- **検証不可能な成果物の提出**
- **技術的負債の意図的先送り**
- **IDE 上でのエラー表示を残したままの完了宣言**
- **テストコードの型チェック緩和設定**

### 強く非推奨

- **手動テストのみによる検証**
- **環境依存の検証方法**
- **「テストだから品質を下げても良い」という考え方**
- **複雑すぎる受け入れテスト**

## 🔧 ツール・自動化

### 必須ツール

- **pytest**: 受け入れテスト実行
- **taskStatus**: タスク状態管理
- **uv**: 依存関係・環境管理
- **ruff**: コード品質チェック

### 推奨ツール

- **pre-commit**: コミット前品質チェック
- **mypy**: 型チェック
- **coverage**: カバレッジ測定

## 📝 ドキュメント要件

### 各タスクに必須

- **適切な検証方法**: コード系は既存テスト、インフラ系はコマンド確認
- **完了基準の明記**: tasks.md 内での客観的基準定義
- **検証手順**: 実行可能なコマンド・テストの明記
- **専用テスト最小化**: 既存テスト資産を最大活用、専用テストは本当に必要な場合のみ

### 品質保証

- **実行可能性**: 他メンバーが同じ手順で検証可能
- **保守性**: テストの意図・目的が明確、保守コスト最小化
- **拡張性**: 将来の要件変更に対応可能

## 🎯 成功基準

### プロジェクトレベル

- **技術的負債の最小化**: 各タスク完了時点での負債ゼロ
- **品質の一貫性**: 全タスクで同等の品質基準維持
- **開発効率の向上**: 後続タスクでの予期しない問題の排除

### チームレベル

- **信頼性の向上**: 成果物の品質に対する信頼
- **属人化の排除**: 客観的基準による評価統一
- **学習効果の最大化**: 品質意識の向上

---

**適用開始**: 2025 年 8 月 4 日
**対象**: 全実装タスク
**例外**: ユーザー明示的承認時のみ
