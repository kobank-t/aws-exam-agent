# „Éá„Éº„Çø„É¢„Éá„É´Ë®≠Ë®à

## „Çµ„Éº„Éê„Éº„É¨„Çπ„Éá„Éº„Çø„Éô„Éº„ÇπË®≠Ë®à (DynamoDB)

### 1. „ÉÜ„Éº„Éñ„É´Ë®≠Ë®àÊ¶ÇË¶Å

**Âçò‰∏Ä„ÉÜ„Éº„Éñ„É´Ë®≠Ë®à (Single Table Design) „ÇíÊé°Áî®:**

**Ë®≠Ë®àÊ†πÊã†:**

- **„Ç≥„Çπ„ÉàÂäπÁéá**: Ë§áÊï∞„ÉÜ„Éº„Éñ„É´„Çà„ÇäÂçò‰∏Ä„ÉÜ„Éº„Éñ„É´„ÅÆÊñπ„Åå RCU/WCU ÂäπÁéá„ÅåËâØ„ÅÑ
- **„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ**: Èñ¢ÈÄ£„Éá„Éº„Çø„Çí 1 Âõû„ÅÆ„ÇØ„Ç®„É™„ÅßÂèñÂæóÂèØËÉΩÔºàJOIN „Åå‰∏çË¶ÅÔºâ
- **ÈÅãÁî®Á∞°Á¥†Âåñ**: „ÉÜ„Éº„Éñ„É´Êï∞ÂâäÊ∏õ„Å´„Çà„Çã„É°„É≥„ÉÜ„Éä„É≥„ÇπË≤†Ëç∑ËªΩÊ∏õ
- **„Çπ„Ç±„Éº„É©„Éì„É™„ÉÜ„Ç£**: DynamoDB „ÅÆÁâπÊÄß„ÇíÊúÄÂ§ßÈôêÊ¥ªÁî®

**ÂÆüË£ÖÊñπÂºè:**

- 1 „Å§„ÅÆ DynamoDB „ÉÜ„Éº„Éñ„É´„ÅßÂÖ®„Éá„Éº„Çø„ÇíÁÆ°ÁêÜ
- „Éë„Éº„ÉÜ„Ç£„Ç∑„Éß„É≥„Ç≠„Éº(PK)„Å®„ÇΩ„Éº„Éà„Ç≠„Éº(SK)„Åß„Ç®„É≥„ÉÜ„Ç£„ÉÜ„Ç£„ÇíË≠òÂà•
- GSI (Global Secondary Index) „ÅßÂäπÁéáÁöÑ„Å™„ÇØ„Ç®„É™„ÇíÂÆüÁèæ

### 2. „É°„Ç§„É≥„ÉÜ„Éº„Éñ„É´: `aws-exam-coach-data`

```json
{
  "TableName": "aws-exam-coach-data",
  "KeySchema": [
    { "AttributeName": "PK", "KeyType": "HASH" },
    { "AttributeName": "SK", "KeyType": "RANGE" }
  ],
  "AttributeDefinitions": [
    { "AttributeName": "PK", "AttributeType": "S" },
    { "AttributeName": "SK", "AttributeType": "S" },
    { "AttributeName": "GSI1PK", "AttributeType": "S" },
    { "AttributeName": "GSI1SK", "AttributeType": "S" },
    { "AttributeName": "GSI2PK", "AttributeType": "S" },
    { "AttributeName": "GSI2SK", "AttributeType": "S" }
  ],
  "GlobalSecondaryIndexes": [
    {
      "IndexName": "GSI1",
      "KeySchema": [
        { "AttributeName": "GSI1PK", "KeyType": "HASH" },
        { "AttributeName": "GSI1SK", "KeyType": "RANGE" }
      ],
      "Projection": {
        "ProjectionType": "ALL"
      }
    },
    {
      "IndexName": "GSI2",
      "KeySchema": [
        { "AttributeName": "GSI2PK", "KeyType": "HASH" },
        { "AttributeName": "GSI2SK", "KeyType": "RANGE" }
      ],
      "Projection": {
        "ProjectionType": "ALL"
      }
    }
  ]
}
```

## 3. „Éá„Éº„Çø„Ç®„É≥„ÉÜ„Ç£„ÉÜ„Ç£Ë®≠Ë®à

### ÂïèÈ°å„Éá„Éº„Çø (Question)

```json
{
  "PK": "QUESTION#q_20250729_001",
  "SK": "METADATA",
  "EntityType": "Question",
  "question_id": "q_20250729_001",
  "question_text": "VPC„Å´Èñ¢„Åô„ÇãÂïèÈ°å„Åß„ÅôÔºü",
  "choices": ["ÈÅ∏ÊäûËÇ¢A", "ÈÅ∏ÊäûËÇ¢B", "ÈÅ∏ÊäûËÇ¢C", "ÈÅ∏ÊäûËÇ¢D"],
  "correct_answer": "B",
  "explanation": "Ê≠£Ëß£„ÅØB„Åß„Åô„ÄÇÁêÜÁî±„ÅØ...",
  "service": "EC2",
  "topic": "VPC",
  "difficulty": "Professional",
  "source_documents": ["vpc-user-guide", "exam-guide"],
  "quality_score": 0.85,
  "created_at": "2025-07-29T10:00:00Z",
  "updated_at": "2025-07-29T10:00:00Z",
  "created_by": "system",
  "GSI1PK": "SERVICE#EC2",
  "GSI1SK": "CREATED#2025-07-29T10:00:00Z",
  "GSI2PK": "DIFFICULTY#Professional",
  "GSI2SK": "QUALITY#0.85"
}
```

### ÈÖç‰ø°Â±•Ê≠¥ (Delivery)

```json
{
  "PK": "DELIVERY#d_20250729_001",
  "SK": "METADATA",
  "EntityType": "Delivery",
  "delivery_id": "d_20250729_001",
  "question_id": "q_20250729_001",
  "teams_message_id": "teams_msg_12345",
  "teams_channel_id": "19:abc123@thread.tacv2",
  "posted_at": "2025-07-29T10:05:00Z",
  "status": "posted",
  "total_responses": 0,
  "correct_responses": 0,
  "correct_rate": null,
  "response_details": {},
  "error_message": null,
  "answered_at": null,
  "GSI1PK": "QUESTION#q_20250729_001",
  "GSI1SK": "DELIVERY#d_20250729_001",
  "GSI2PK": "STATUS#posted",
  "GSI2SK": "POSTED#2025-07-29T10:05:00Z"
}
```

### „É¶„Éº„Ç∂„ÉºÂõûÁ≠î (UserResponse)

```json
{
  "PK": "DELIVERY#d_20250729_001",
  "SK": "USER#user123",
  "EntityType": "UserResponse",
  "delivery_id": "d_20250729_001",
  "user_id": "user123",
  "user_name": "Áî∞‰∏≠Â§™ÈÉé",
  "selected_answer": "B",
  "is_correct": true,
  "responded_at": "2025-07-29T11:30:00Z",
  "reaction_type": "üÖ±Ô∏è",
  "GSI1PK": "USER#user123",
  "GSI1SK": "RESPONDED#2025-07-29T11:30:00Z",
  "GSI2PK": "DELIVERY#d_20250729_001",
  "GSI2SK": "RESPONSE#2025-07-29T11:30:00Z"
}
```

### „Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆö (SystemSettings)

```json
{
  "PK": "SETTINGS",
  "SK": "CONFIG",
  "EntityType": "SystemSettings",
  "teams_channel_id": "19:abc123@thread.tacv2",
  "daily_question_time": "10:00",
  "answer_reveal_delay": 24,
  "max_questions_per_day": 1,
  "quality_threshold": 0.8,
  "updated_at": "2025-07-29T09:00:00Z",
  "updated_by": "admin"
}
```

## 4. „Ç¢„ÇØ„Çª„Çπ„Éë„Çø„Éº„É≥„Å®„ÇØ„Ç®„É™Ë®≠Ë®à

### ‰∏ªË¶Å„Å™„Ç¢„ÇØ„Çª„Çπ„Éë„Çø„Éº„É≥

#### 1. ÂïèÈ°å„ÅÆÂèñÂæó

```python
# ÁâπÂÆöÂïèÈ°å„ÅÆÂèñÂæó
response = dynamodb.get_item(
    Key={'PK': 'QUESTION#q_20250729_001', 'SK': 'METADATA'}
)

# „Çµ„Éº„Éì„ÇπÂà•ÂïèÈ°å‰∏ÄË¶ß
response = dynamodb.query(
    IndexName='GSI1',
    KeyConditionExpression='GSI1PK = :service',
    ExpressionAttributeValues={':service': 'SERVICE#EC2'}
)
```

#### 2. ÈÖç‰ø°Â±•Ê≠¥„ÅÆÁÆ°ÁêÜ

```python
# ÈÖç‰ø°Â±•Ê≠¥„ÅÆÂèñÂæó
response = dynamodb.get_item(
    Key={'PK': 'DELIVERY#d_20250729_001', 'SK': 'METADATA'}
)

# ÂïèÈ°å„Å´ÂØæ„Åô„ÇãÈÖç‰ø°Â±•Ê≠¥
response = dynamodb.query(
    IndexName='GSI1',
    KeyConditionExpression='GSI1PK = :question_id',
    ExpressionAttributeValues={':question_id': 'QUESTION#q_20250729_001'}
)
```

#### 3. „É¶„Éº„Ç∂„ÉºÂõûÁ≠î„ÅÆÈõÜË®à

```python
# ÁâπÂÆöÈÖç‰ø°„ÅÆÂÖ®ÂõûÁ≠î
response = dynamodb.query(
    KeyConditionExpression='PK = :delivery_id AND begins_with(SK, :user_prefix)',
    ExpressionAttributeValues={
        ':delivery_id': 'DELIVERY#d_20250729_001',
        ':user_prefix': 'USER#'
    }
)

# „É¶„Éº„Ç∂„Éº„ÅÆÂõûÁ≠îÂ±•Ê≠¥
response = dynamodb.query(
    IndexName='GSI1',
    KeyConditionExpression='GSI1PK = :user_id',
    ExpressionAttributeValues={':user_id': 'USER#user123'}
)
```

## 5. È°û‰ººÂ∫¶„ÉÅ„Çß„ÉÉ„ÇØ„ÅÆÁ∞°Á¥†Âåñ

### ÂæìÊù•„ÅÆ„Ç¢„Éó„É≠„Éº„ÉÅ (RDB)

- ÂÖ®ÂïèÈ°å„Å´ÂØæ„Åó„Å¶„Éô„ÇØ„Éà„É´È°û‰ººÂ∫¶Ë®àÁÆó
- Ë§áÈõë„Å™ SQL Êñá„Åß„ÅÆÈ°û‰ººÂ∫¶Ê§úÁ¥¢

### DynamoDB Âêë„ÅëÁ∞°Á¥†Âåñ„Ç¢„Éó„É≠„Éº„ÉÅ

```python
class SimpleSimilarityChecker:
    def __init__(self):
        self.similarity_threshold = 0.70

    async def check_similarity(self, new_question: Question) -> bool:
        """Á∞°Á¥†Âåñ„Åï„Çå„ÅüÈ°û‰ººÂ∫¶„ÉÅ„Çß„ÉÉ„ÇØ"""
        # 1. „Çµ„Éº„Éì„Çπ„Éª„Éà„Éî„ÉÉ„ÇØ„ÅåÂêå„ÅòÂïèÈ°å„ÇíÂèñÂæó
        similar_questions = await self._get_questions_by_service_topic(
            new_question.service, new_question.topic
        )

        # 2. „Ç≠„Éº„ÉØ„Éº„Éâ„Éô„Éº„Çπ„ÅÆÁ∞°ÊòìÈ°û‰ººÂ∫¶Ë®àÁÆó
        for existing_question in similar_questions:
            similarity = self._calculate_keyword_similarity(
                new_question.question_text,
                existing_question.question_text
            )

            if similarity > self.similarity_threshold:
                return False  # È°û‰ººÂïèÈ°å„ÅåÂ≠òÂú®

        return True  # È°û‰ººÂïèÈ°å„Å™„Åó

    def _calculate_keyword_similarity(self, text1: str, text2: str) -> float:
        """„Ç≠„Éº„ÉØ„Éº„Éâ„Éô„Éº„Çπ„ÅÆÁ∞°ÊòìÈ°û‰ººÂ∫¶Ë®àÁÆó"""
        # ÂΩ¢ÊÖãÁ¥†Ëß£Êûê„ÇÑTF-IDF„ÅÆ‰ª£„Çè„Çä„Å´ÂçòÁ¥î„Å™ÂçòË™û‰∏ÄËá¥Áéá„Çí‰ΩøÁî®
        words1 = set(text1.split())
        words2 = set(text2.split())

        intersection = words1.intersection(words2)
        union = words1.union(words2)

        return len(intersection) / len(union) if union else 0.0
```

## „Çµ„Éº„Éê„Éº„É¨„Çπ„Ç≠„É£„ÉÉ„Ç∑„É•Ë®≠Ë®à

### Ë®≠Ë®àÊ†πÊã†

**„Ç≠„É£„ÉÉ„Ç∑„É•Â∞éÂÖ•„ÅÆÁêÜÁî±:**

1. **„Ç≥„Çπ„ÉàÂâäÊ∏õ**: Bedrock API ($0.003/1K tokens) + MCP Server Âëº„Å≥Âá∫„Åó„Ç≥„Çπ„Éà„ÇíÂâäÊ∏õ
2. **„É¨„Çπ„Éù„É≥„ÇπÊôÇÈñìÁü≠Á∏Æ**: Â§ñÈÉ® API Âëº„Å≥Âá∫„Åó (3-5 Áßí) ‚Üí „Ç≠„É£„ÉÉ„Ç∑„É•ÂèñÂæó (50ms)
3. **API Âà∂ÈôêÂõûÈÅø**: Â§ñÈÉ®„Çµ„Éº„Éì„Çπ„ÅÆ„É¨„Éº„ÉàÂà∂Èôê„ÉªÈöúÂÆ≥ÊôÇ„ÅÆÂΩ±ÈüøËªΩÊ∏õ
4. **„É¶„Éº„Ç∂„Éº‰ΩìÈ®ìÂêë‰∏ä**: ÂïèÈ°åÁîüÊàêÂæÖÊ©üÊôÇÈñì„ÅÆÂ§ßÂπÖÁü≠Á∏Æ

**DynamoDB TTL ÈÅ∏Êäû„ÅÆÁêÜÁî±:**

- „Çµ„Éº„Éê„Éº„É¨„ÇπÁí∞Â¢É„Åß Redis „Ç§„É≥„Çπ„Çø„É≥„ÇπÁÆ°ÁêÜ„Åå‰∏çË¶Å
- Ëá™ÂãïÁöÑ„Å™„Éá„Éº„ÇøÂâäÈô§„Åß„É°„É≥„ÉÜ„Éä„É≥„Çπ„Éï„É™„Éº
- Lambda Èñì„Åß„ÅÆ„Ç≠„É£„ÉÉ„Ç∑„É•ÂÖ±Êúâ„ÅåÂèØËÉΩ
- AWS Áµ±Âêà„Å´„Çà„ÇãÈÅãÁî®„Ç≥„Çπ„ÉàÂâäÊ∏õ

### 1. DynamoDB TTL „ÇíÊ¥ªÁî®„Åó„Åü„Ç≠„É£„ÉÉ„Ç∑„É•

**„Ç≠„É£„ÉÉ„Ç∑„É•Â∞ÇÁî®„ÉÜ„Éº„Éñ„É´: `aws-exam-coach-cache`**

```json
{
  "TableName": "aws-exam-coach-cache",
  "KeySchema": [{ "AttributeName": "cache_key", "KeyType": "HASH" }],
  "AttributeDefinitions": [
    { "AttributeName": "cache_key", "AttributeType": "S" }
  ],
  "TimeToLiveSpecification": {
    "AttributeName": "ttl",
    "Enabled": true
  }
}
```

**„Ç≠„É£„ÉÉ„Ç∑„É•„Éá„Éº„ÇøÊßãÈÄ†:**

```json
{
  "cache_key": "aws_doc:EC2:VPC",
  "cache_value": "AWS VPC documentation content...",
  "created_at": "2025-07-29T10:00:00Z",
  "ttl": 1722340800
}
```

### 2. Lambda „É°„É¢„É™„Ç≠„É£„ÉÉ„Ç∑„É• (Áü≠ÊúüÈñì)

```python
import time
from typing import Dict, Any, Optional

class LambdaMemoryCache:
    """LambdaÂÆüË°åÁí∞Â¢ÉÂÜÖ„Åß„ÅÆ„É°„É¢„É™„Ç≠„É£„ÉÉ„Ç∑„É•"""

    def __init__(self):
        self._cache: Dict[str, Dict[str, Any]] = {}

    def get(self, key: str) -> Optional[Any]:
        if key in self._cache:
            item = self._cache[key]
            if time.time() < item['expires_at']:
                return item['value']
            else:
                del self._cache[key]
        return None

    def set(self, key: str, value: Any, ttl_seconds: int = 300):
        """„Éá„Éï„Ç©„É´„Éà5ÂàÜÈñì„Ç≠„É£„ÉÉ„Ç∑„É•"""
        self._cache[key] = {
            'value': value,
            'expires_at': time.time() + ttl_seconds
        }

    def clear(self):
        self._cache.clear()

# „Ç∞„É≠„Éº„Éê„É´„Ç§„É≥„Çπ„Çø„É≥„ÇπÔºàLambdaÂÆüË°åÁí∞Â¢É„ÅßÂÜçÂà©Áî®Ôºâ
memory_cache = LambdaMemoryCache()
```

### 3. „Ç≠„É£„ÉÉ„Ç∑„É•ÁÆ°ÁêÜ„ÇØ„É©„Çπ

```python
class ServerlessCacheManager:
    def __init__(self, cache_table_name: str = "aws-exam-coach-cache"):
        self.dynamodb = boto3.resource('dynamodb')
        self.cache_table = self.dynamodb.Table(cache_table_name)
        self.memory_cache = memory_cache

    async def get_aws_doc(self, service: str, topic: str) -> Optional[str]:
        cache_key = f"aws_doc:{service}:{topic}"

        # 1. „É°„É¢„É™„Ç≠„É£„ÉÉ„Ç∑„É•„Åã„ÇâÁ¢∫Ë™ç
        cached_value = self.memory_cache.get(cache_key)
        if cached_value:
            return cached_value

        # 2. DynamoDB„Ç≠„É£„ÉÉ„Ç∑„É•„Åã„ÇâÁ¢∫Ë™ç
        try:
            response = self.cache_table.get_item(Key={'cache_key': cache_key})
            if 'Item' in response:
                value = response['Item']['cache_value']
                # „É°„É¢„É™„Ç≠„É£„ÉÉ„Ç∑„É•„Å´„ÇÇ‰øùÂ≠òÔºà5ÂàÜÈñìÔºâ
                self.memory_cache.set(cache_key, value, 300)
                return value
        except Exception as e:
            logger.warning(f"„Ç≠„É£„ÉÉ„Ç∑„É•ÂèñÂæó„Ç®„É©„Éº: {e}")

        return None

    async def cache_aws_doc(self, service: str, topic: str, content: str, ttl_hours: int = 24):
        cache_key = f"aws_doc:{service}:{topic}"

        # TTLË®≠ÂÆöÔºà24ÊôÇÈñìÂæåÔºâ
        ttl = int(time.time()) + (ttl_hours * 3600)

        # DynamoDB„Å´‰øùÂ≠ò
        try:
            self.cache_table.put_item(
                Item={
                    'cache_key': cache_key,
                    'cache_value': content,
                    'created_at': datetime.now().isoformat(),
                    'ttl': ttl
                }
            )

            # „É°„É¢„É™„Ç≠„É£„ÉÉ„Ç∑„É•„Å´„ÇÇ‰øùÂ≠ò
            self.memory_cache.set(cache_key, content, 300)

        except Exception as e:
            logger.error(f"„Ç≠„É£„ÉÉ„Ç∑„É•‰øùÂ≠ò„Ç®„É©„Éº: {e}")
```
