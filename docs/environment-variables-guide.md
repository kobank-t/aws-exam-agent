# ç’°å¢ƒå¤‰æ•°è¨­å®šã‚¬ã‚¤ãƒ‰

Cloud CoPassAgent ã®ç’°å¢ƒå¤‰æ•°è¨­å®šã«ã¤ã„ã¦èª¬æ˜Žã—ã¾ã™ã€‚

## ðŸ”§ å¿…é ˆç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å                          | èª¬æ˜Ž                                       | ä¾‹                                                                 | è¨­å®šå ´æ‰€      |
| ------------------------------- | ------------------------------------------ | ------------------------------------------------------------------ | ------------- |
| `POWER_AUTOMATE_WEBHOOK_URL`    | Teams é€£æºç”¨ Webhook URL                   | `https://prod-XX.japaneast.logic.azure.com/workflows/...`          | .env ãƒ•ã‚¡ã‚¤ãƒ« |
| `POWER_AUTOMATE_SECURITY_TOKEN` | Webhook URL æ¼æ´©å¯¾ç­–ç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³ | `cef26f0de574983a475345f2e3518abbd6472d102b5254384ef6912931f8a68f` | .env ãƒ•ã‚¡ã‚¤ãƒ« |

## ðŸ’» ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

### .env ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆï¼ˆ64æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼‰
SECURITY_TOKEN=$(openssl rand -hex 32)

# .envãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
cat > .env << EOF
# Teams é€£æºï¼ˆå¿…é ˆï¼‰
POWER_AUTOMATE_WEBHOOK_URL=https://prod-XX.japaneast.logic.azure.com/workflows/YOUR-WORKFLOW-ID/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=YOUR-SIGNATURE

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆå¿…é ˆï¼‰
POWER_AUTOMATE_SECURITY_TOKEN=$SECURITY_TOKEN
EOF
```

### Power Automate Webhook URL ã®å–å¾—æ–¹æ³•

1. **Microsoft Teams** ã§ Power Automate ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆ
2. **HTTP è¦æ±‚ã®å—ä¿¡æ™‚** ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®š
3. **Teams ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿** ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
4. ç”Ÿæˆã•ã‚ŒãŸ **HTTP POST URL** ã‚’ã‚³ãƒ”ãƒ¼

### Power Automate ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³è¨­å®š

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹ Webhook URL æ¼æ´©å¯¾ç­–ã‚’è¨­å®šï¼š

1. **Power Automate ãƒ•ãƒ­ãƒ¼** ã§ã€ŒHTTP è¦æ±‚ã®å—ä¿¡æ™‚ã€ãƒˆãƒªã‚¬ãƒ¼ã‚’é¸æŠž
2. **æ¡ä»¶** ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
3. **æ¡ä»¶å¼** ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šï¼š
   ```
   @equals(triggerBody()?['security_token'], 'YOUR_SECURITY_TOKEN_HERE')
   ```
4. **ã€Œã¯ã„ã€ã®å ´åˆ** ã« Teams æŠ•ç¨¿ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é…ç½®
5. **ã€Œã„ã„ãˆã€ã®å ´åˆ** ã¯ä½•ã‚‚ã—ãªã„ï¼ˆä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç„¡è¦–ï¼‰

**é‡è¦**: `YOUR_SECURITY_TOKEN_HERE` ã‚’ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã§ç”Ÿæˆã—ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

## ðŸš€ AgentCore ã§ã®ç’°å¢ƒå¤‰æ•°

AgentCore ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ã€`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è‡ªå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ï¼š

```bash
# ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè‡ªå‹•å®Ÿè¡Œ
./scripts/deploy-agentcore.sh
```

ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã‚’è‡ªå‹•å®Ÿè¡Œï¼š

1. `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ `POWER_AUTOMATE_WEBHOOK_URL` ã‚’èª­ã¿è¾¼ã¿
2. AgentCore ã«ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è¨­å®š
3. Teams é€£æºæ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–

## ðŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

- **Git ç®¡ç†**: `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.gitignore` ã«å«ã¾ã‚Œã¦ãŠã‚Šã€Git ã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¾ã›ã‚“
- **æœ€å°æ¨©é™**: Webhook URL ã®ã¿ã‚’è¨­å®šã—ã€ä¸è¦ãªèªè¨¼æƒ…å ±ã¯å«ã‚ã¾ã›ã‚“
- **AWS èªè¨¼**: AgentCore ã§ã¯ IAM Role ã«ã‚ˆã‚‹èªè¨¼ã‚’ä½¿ç”¨ï¼ˆèªè¨¼æƒ…å ±ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ä¸è¦ï¼‰
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³**: Webhook URL æ¼æ´©æ™‚ã®ä¸æ­£åˆ©ç”¨ã‚’é˜²ããŸã‚ã€64 æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã§èªè¨¼
- **äºŒé‡èªè¨¼**: Power Automate å´ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã—ã€æ­£ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã®å ´åˆã®ã¿ Teams æŠ•ç¨¿ã‚’å®Ÿè¡Œ

## ðŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **Webhook URL æœªè¨­å®šã‚¨ãƒ©ãƒ¼**:

   ```
   âŒ POWER_AUTOMATE_WEBHOOK_URL ãŒ .env ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“
   ```

   â†’ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«æ­£ã—ã„ Webhook URL ã‚’è¨­å®š

2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³æœªè¨­å®šã‚¨ãƒ©ãƒ¼**:

   ```
   âŒ POWER_AUTOMATE_SECURITY_TOKEN ãŒ .env ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“
   ```

   â†’ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã« 64 æ–‡å­—ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®š

3. **Teams æŠ•ç¨¿å¤±æ•—ï¼ˆèªè¨¼ã‚¨ãƒ©ãƒ¼ï¼‰**:

   ```
   TeamsæŠ•ç¨¿å®Œäº† (HTTP 202) ã ãŒã€å®Ÿéš›ã«ã¯Teamsã«æŠ•ç¨¿ã•ã‚Œãªã„
   ```

   â†’ Power Automate ãƒ•ãƒ­ãƒ¼ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³æ¡ä»¶ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

4. **Teams æŠ•ç¨¿å¤±æ•—ï¼ˆä¸€èˆ¬ã‚¨ãƒ©ãƒ¼ï¼‰**:

   ```
   TeamsæŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ: HTTP 400/401/403
   ```

   â†’ Power Automate ãƒ•ãƒ­ãƒ¼ãŒæœ‰åŠ¹ã‹ã€Webhook URL ãŒæ­£ã—ã„ã‹ç¢ºèª

5. **ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿å¤±æ•—**:
   ```
   âš ï¸ .env ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
   ```
   â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« `.env` ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

```bash
# .env ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
cat .env

# AgentCore ãƒ­ã‚°ã§ã®ç¢ºèª
aws logs tail /aws/bedrock-agentcore/runtimes/agent_main-XXXXX-DEFAULT --since 1h | grep -i teams
```

## ðŸ“ ãã®ä»–ã®è¨­å®š

ä»¥ä¸‹ã®è¨­å®šã¯ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è¨­å®šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ï¼š

- **AWS èªè¨¼æƒ…å ±**: IAM Role ã§è‡ªå‹•èªè¨¼
- **AWS ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: `us-east-1` ã§å›ºå®š
- **Bedrock ãƒ¢ãƒ‡ãƒ«**: `amazon.nova-pro-v1:0` ã§å›ºå®šï¼ˆã‚³ã‚¹ãƒˆæœ€é©åŒ–æ¸ˆã¿ï¼‰
- **ãƒˆãƒ¼ã‚¯ãƒ³æ•°ãƒ»æ¸©åº¦**: Strands Agents ã§æœ€é©åŒ–æ¸ˆã¿
